# Salah-Eddine JAOUAD

---

# üè¶ Bank Microservices - Application Bancaire

Une architecture micro-services compl√®te pour la gestion des virements et b√©n√©ficiaires bancaires, construite avec Spring Boot 3.5.6 et Spring Cloud 2025.0.0.

## üìã Table des Mati√®res

- [Architecture](#architecture)
- [Technologies Utilis√©es](#technologies-utilis√©es)
- [Modules du Projet](#modules-du-projet)
- [Pr√©requis](#pr√©requis)
- [Installation et D√©marrage](#installation-et-d√©marrage)
- [Configuration](#configuration)
- [APIs et Documentation](#apis-et-documentation)
- [Tests](#tests)
- [Fonctionnalit√©s](#fonctionnalit√©s)

## üèóÔ∏è Architecture

Le projet suit une architecture micro-services moderne avec les composants suivants :

![Architecture](assets\architecture.svg)

## üõ†Ô∏è Technologies Utilis√©es

### Backend
- **Java 25**
- **Spring Boot 3.5.6**
- **Spring Cloud 2025.0.0**
  - Eureka (Service Discovery)
  - Config Server
  - Gateway
  - OpenFeign (Communication inter-services)
- **Spring Data JPA & REST**
- **Spring AI (OpenAI GPT-OSS-20B)**
- **H2 Database** (mode m√©moire)
- **Lombok** (R√©duction du boilerplate)
- **SpringDoc OpenAPI 3** (Documentation API)
- **dotenv-java** (Gestion s√©curis√©e des secrets)

### Infrastructure
- **Maven** (Gestion des d√©pendances)
- **Git** (Configuration centralis√©e)
- **Spring Actuator** (Monitoring)

## üì¶ Modules du Projet

### 1. Discovery Service (Port 8761)
Service de d√©couverte utilisant Netflix Eureka Server.
- Enregistrement automatique de tous les microservices
- Dashboard de monitoring : http://localhost:8761

### 2. Config Service (Port 8888)
Service de configuration centralis√©e avec Spring Cloud Config.
- Repository Git local pour les configurations
- Support de profils multiples
- Rafra√Æchissement dynamique des configurations

### 3. Gateway Service (Port 8080)
API Gateway pour le routage des requ√™tes.
- Routes dynamiques bas√©es sur Eureka
- Load balancing automatique
- Point d'entr√©e unique pour tous les services

**Routes configur√©es :**
- `/api/beneficiaires/**` ‚Üí Beneficiaire Service
- `/api/virements/**` ‚Üí Virement Service
- `/api/chat/**` ‚Üí Chat-Bot Service

### 4. Beneficiaire Service (Port 8081)
Gestion des b√©n√©ficiaires bancaires.

**Entit√© B√©n√©ficiaire :**
- `id` : Long (auto-g√©n√©r√©)
- `nom` : String
- `prenom` : String
- `rib` : String (24 caract√®res)
- `type` : TypeBeneficiaire (PHYSIQUE, MORALE)

**Endpoints REST :**
- `GET /api/beneficiaires` - Liste tous les b√©n√©ficiaires
- `GET /api/beneficiaires/{id}` - R√©cup√®re un b√©n√©ficiaire
- `POST /api/beneficiaires` - Cr√©e un b√©n√©ficiaire
- `PUT /api/beneficiaires/{id}` - Met √† jour un b√©n√©ficiaire
- `DELETE /api/beneficiaires/{id}` - Supprime un b√©n√©ficiaire
- `GET /api/beneficiaires/search/byType?type=PHYSIQUE` - Recherche par type
- `GET /api/beneficiaires/search/byRib?rib=MA...` - Recherche par RIB

### 5. Virement Service (Port 8082)
Gestion des virements bancaires avec communication Feign.

**Entit√© Virement :**
- `id` : Long (auto-g√©n√©r√©)
- `idBeneficiaire` : Long
- `ribSource` : String (24 caract√®res)
- `montant` : Double
- `description` : String
- `dateVirement` : Date
- `type` : TypeVirement (NORMAL, INSTANTANE)

**Endpoints REST :**
- `GET /api/virements` - Liste tous les virements
- `GET /api/virements/{id}` - R√©cup√®re un virement
- `POST /api/virements` - Cr√©e un virement
- `GET /api/virements/full/{id}` - Virement avec donn√©es du b√©n√©ficiaire (Feign)
- `GET /api/virements/full` - Tous les virements enrichis
- `GET /api/virements/search/byBeneficiaire?idBeneficiaire=1`
- `GET /api/virements/search/byType?type=INSTANTANE`

### 6. Chat-Bot Service (Port 8083)
Assistant bancaire intelligent avec Spring AI et OpenAI GPT-OSS-20B.

**Configuration :**
- Mod√®le: `gpt-oss-20b`
- Temperature: `0.7`
- Stockage s√©curis√© de la cl√© API via fichier `.env`

**Fonctionnalit√©s :**
- Syst√®me RAG (Retrieval Augmented Generation)
- Base de connaissances bancaire int√©gr√©e
- Support des questions en fran√ßais
- Contexte bancaire sp√©cialis√©

**Endpoints REST :**
- `POST /api/chat/ask` - Poser une question (avec RAG)
- `GET /api/chat/ask?question=...` - Poser une question (GET)
- `POST /api/chat/simple` - Question simple sans RAG
- `GET /api/chat/health` - V√©rifier le statut

## üöÄ Pr√©requis

- **JDK 25** install√©
- **Maven 3.8+** install√©
- **Git** install√©
- **OpenAI API Key** pour le chat-bot (mod√®le: gpt-oss-20b)

## üì• Installation et D√©marrage

### 1. Cloner le projet

```powershell
cd "bank-microservices/"
```

### 2. Configurer l'API OpenAI (IMPORTANT)

#### Option A : Script automatique (Recommand√©)
```powershell
.\setup-openai.ps1
```
Ce script vous guidera pour configurer votre cl√© API de mani√®re s√©curis√©e.

#### Option B : Configuration manuelle
1. Copiez le fichier `.env.example` vers `.env`:
   ```powershell
   Copy-Item .env.example .env
   ```

2. Ouvrez `.env` et remplacez `your-openai-api-key-here` par votre vraie cl√© API:
   ```
   OPENAI_API_KEY=sk-your-actual-api-key-here
   ```

**‚ö†Ô∏è S√©curit√©:** Le fichier `.env` est automatiquement ignor√© par Git et ne sera jamais committ√©.

üìñ **Pour plus de d√©tails:** Consultez [OPENAI-SETUP.md](OPENAI-SETUP.md)

### 3. Compiler le projet parent

```powershell
mvn clean install -DskipTests
```

### 4. D√©marrage automatique de tous les services

```powershell
.\start-all-services.ps1
```

Ce script va:
- ‚úÖ Charger automatiquement les variables d'environnement depuis `.env`
- ‚úÖ Compiler le projet
- ‚úÖ D√©marrer tous les services dans le bon ordre
- ‚úÖ Ouvrir chaque service dans une nouvelle fen√™tre PowerShell

### 5. D√©marrage manuel (optionnel)

#### √âtape 1 : Discovery Service (OBLIGATOIRE EN PREMIER)
```powershell
cd discovery-service
mvn spring-boot:run
```
Attendre que le service d√©marre compl√®tement (Dashboard disponible √† http://localhost:8761)

#### √âtape 2 : Config Service
```powershell
cd ..\config-service
mvn spring-boot:run
```
Attendre l'enregistrement dans Eureka

#### √âtape 3 : Gateway Service
```powershell
cd ..\gateway-service
mvn spring-boot:run
```

#### √âtape 4 : Services M√©tiers (en parall√®le dans des terminaux s√©par√©s)

**Beneficiaire Service :**
```powershell
cd ..\beneficiaire-service
mvn spring-boot:run
```

**Virement Service :**
```powershell
cd ..\virement-service
mvn spring-boot:run
```

**Chat-Bot Service :**
```powershell
cd ..\chat-bot-service
mvn spring-boot:run
```
**Note:** La cl√© API OpenAI sera automatiquement charg√©e depuis le fichier `.env`

### 6. V√©rifier le d√©marrage

Tous les services doivent appara√Ætre dans le dashboard Eureka :
üëâ http://localhost:8761

## ‚öôÔ∏è Configuration

### Repository Git de Configuration

Les configurations sont centralis√©es dans : `config-repo/`

**Fichiers de configuration :**
- `beneficiaire-service.yml`
- `virement-service.yml`
- `gateway-service.yml`
- `chat-bot-service.yml`

Pour modifier une configuration :
```powershell
git add .
git commit -m "Update configuration"
# Red√©marrer le service concern√©
```

### Cl√© API OpenAI

Pour utiliser le Chat-Bot Service, configurez votre cl√© API :

**Option 1 : Variable d'environnement (recommand√©)**
```powershell
$env:OPENAI_API_KEY="sk-votre-cle-api"
```

**Option 2 : Fichier application.yml**
```yaml
spring:
  ai:
    openai:
      api-key: sk-votre-cle-api
```

**Option 3 : Config Server**
Modifier `C:\Users\JD\config-repo\chat-bot-service.yml`

## üìö APIs et Documentation

### Swagger UI (Documentation Interactive)

Chaque service expose sa documentation Swagger :

- **Beneficiaire Service :** http://localhost:8081/swagger-ui.html
- **Virement Service :** http://localhost:8082/swagger-ui.html

### Via Gateway (Point d'entr√©e unique)

- **Beneficiaires :** http://localhost:8080/api/beneficiaires
- **Virements :** http://localhost:8080/api/virements
- **Chat-Bot :** http://localhost:8080/api/chat/ask

### Consoles H2 (Base de donn√©es)

- **Beneficiaire :** http://localhost:8081/h2-console
  - JDBC URL: `jdbc:h2:mem:beneficiairedb`
  - Username: `sa`
  - Password: *(vide)*

- **Virement :** http://localhost:8082/h2-console
  - JDBC URL: `jdbc:h2:mem:virementdb`
  - Username: `sa`
  - Password: *(vide)*

### Actuator (Monitoring)

- **Discovery :** http://localhost:8761/actuator/health
- **Config :** http://localhost:8888/actuator/health
- **Gateway :** http://localhost:8080/actuator/health
- **Beneficiaire :** http://localhost:8081/actuator/health
- **Virement :** http://localhost:8082/actuator/health
- **Chat-Bot :** http://localhost:8083/actuator/health

## üß™ Tests

### Test 1 : V√©rifier tous les services dans Eureka
```
Ouvrir : http://localhost:8761
R√©sultat attendu : 5 services enregistr√©s (CONFIG-SERVICE, GATEWAY-SERVICE, BENEFICIAIRE-SERVICE, VIREMENT-SERVICE, CHAT-BOT-SERVICE)
```

### Test 2 : R√©cup√©rer les b√©n√©ficiaires via Gateway
```powershell
curl http://localhost:8080/api/beneficiaires
```

### Test 3 : Cr√©er un b√©n√©ficiaire
```powershell
curl -X POST http://localhost:8080/api/beneficiaires `
  -H "Content-Type: application/json" `
  -d '{
    "nom": "AMRANI",
    "prenom": "Karim",
    "rib": "MA007890123456789012345678",
    "type": "PHYSIQUE"
  }'
```

### Test 4 : R√©cup√©rer un virement avec b√©n√©ficiaire (Feign)
```powershell
curl http://localhost:8080/api/virements/full/1
```

### Test 5 : Tester le Chat-Bot
```powershell
curl -X POST http://localhost:8080/api/chat/ask `
  -H "Content-Type: application/json" `
  -d '{
    "question": "Quels sont les frais pour un virement instantan√© ?"
  }'
```

### Test 6 : V√©rifier la communication Feign
```powershell
# R√©cup√©rer tous les virements enrichis
curl http://localhost:8082/api/virements/full
```

## üéØ Fonctionnalit√©s

### ‚úÖ Fonctionnalit√©s Impl√©ment√©es

- [x] Service Discovery avec Eureka
- [x] Configuration centralis√©e avec Config Server
- [x] API Gateway avec routage dynamique
- [x] Gestion compl√®te des b√©n√©ficiaires (CRUD)
- [x] Gestion compl√®te des virements (CRUD)
- [x] Communication inter-services avec OpenFeign
- [x] Chat-Bot intelligent avec Spring AI (GPT-4o)
- [x] Syst√®me RAG pour le contexte bancaire
- [x] Documentation API avec Swagger/OpenAPI
- [x] Base de donn√©es H2 en m√©moire
- [x] Monitoring avec Spring Actuator
- [x] Donn√©es de test au d√©marrage
- [x] Support des types de b√©n√©ficiaires (PHYSIQUE/MORALE)
- [x] Support des types de virements (NORMAL/INSTANTANE)

### üîÑ Flux de Communication

1. **Client** ‚Üí **Gateway (8080)** ‚Üí **Service M√©tier (8081/8082/8083)**
2. **Virement Service** ‚Üí **Feign Client** ‚Üí **Beneficiaire Service**
3. **Tous les services** ‚Üí **Eureka Discovery (8761)**
4. **Tous les services** ‚Üí **Config Server (8888)** ‚Üí **Git Repository**

## üóÇÔ∏è Structure du Projet

```
bank-microservices/
‚îú‚îÄ‚îÄ pom.xml (Parent POM)
‚îú‚îÄ‚îÄ discovery-service/
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/.../DiscoveryServiceApplication.java
‚îÇ   ‚îî‚îÄ‚îÄ src/main/resources/application.yml
‚îú‚îÄ‚îÄ config-service/
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/.../ConfigServiceApplication.java
‚îÇ   ‚îî‚îÄ‚îÄ src/main/resources/application.yml
‚îú‚îÄ‚îÄ gateway-service/
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/.../GatewayServiceApplication.java
‚îÇ   ‚îî‚îÄ‚îÄ src/main/resources/application.yml
‚îú‚îÄ‚îÄ beneficiaire-service/
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/Beneficiaire.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ enums/TypeBeneficiaire.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/BeneficiaireRepository.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BeneficiaireServiceApplication.java
‚îÇ   ‚îî‚îÄ‚îÄ src/main/resources/application.yml
‚îú‚îÄ‚îÄ virement-service/
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/Virement.java, BeneficiaireModel.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ enums/TypeVirement.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/VirementRepository.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clients/BeneficiaireClient.java (Feign)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/VirementController.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VirementServiceApplication.java
‚îÇ   ‚îî‚îÄ‚îÄ src/main/resources/application.yml
‚îú‚îÄ‚îÄ chat-bot-service/
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/ChatRequest.java, ChatResponse.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/ChatBotService.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/ChatBotController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/ChatConfig.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ChatBotServiceApplication.java
‚îÇ   ‚îî‚îÄ‚îÄ src/main/resources/application.yml
‚îî‚îÄ‚îÄ README.md
```

## üìÑ Licence

Ce projet est d√©velopp√© dans le cadre d'un TP acad√©mique √† l'ENSET.

---

## Salah-Eddine JAOUAD